image:
  repository: hireflow/gateway
  tag: local
  pullPolicy: IfNotPresent

replicaCount: 2

fullnameOverride: gateway

service:
  type: ClusterIP
  port: 80
  targetPort: 8080

env:
  ASPNETCORE_URLS: "http://0.0.0.0:8080"
  OTEL_EXPORTER_OTLP_ENDPOINT: "http://jaeger-collector.observability.svc.cluster.local:4317"
  OTEL_EXPORTER_OTLP_PROTOCOL: "grpc"
  OTEL_EXPORTER_OTLP_INSECURE: "true"
  OTEL_SERVICE_NAME: "gateway"
  OTEL_TRACES_EXPORTER: "otlp"
  OTEL_TRACES_SAMPLER: "always_on"
  OTEL_METRICS_EXPORTER: "none"
  OTEL_LOGS_EXPORTER: "none"
  OTEL_LOG_LEVEL: "debug"

secretRefName: "hireflow-connections"

ingress:
  enabled: true
  className: nginx
  host: hireflow.localtest.me
  annotations:
    nginx.ingress.kubernetes.io/proxy-body-size: "20m"
  path: /
  pathType: Prefix

resources:
  requests: { cpu: 50m, memory: 192Mi }
  limits:   { cpu: 500m, memory: 512Mi }

lifecycle:
  preStop:
    exec:
      command: ["/bin/sh", "-c", "sleep 5"]

startupProbe:
  httpGet:
    path: /healthz
    port: http
  failureThreshold: 30
  periodSeconds: 2

readinessProbe:
  httpGet:
    path: /ready
    port: http
  initialDelaySeconds: 2
  periodSeconds: 5

livenessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 10
  periodSeconds: 10

strategy:
  type: RollingUpdate
  rollingUpdate:
    maxUnavailable: 0
    maxSurge: 1

terminationGracePeriodSeconds: 30

podDisruptionBudget:
  enabled: true
  minAvailable: 1

securityContext:
  runAsNonRoot: true
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: true

affinity:
  podAntiAffinity:
    preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          topologyKey: kubernetes.io/hostname
          labelSelector:
            matchLabels:
              app.kubernetes.io/name: gateway
              app.kubernetes.io/instance: ""   # placeholder; template will override

